{"ast":null,"code":"import _toConsumableArray from\"D:/react-myprojects/hrms-airtable-july2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"D:/react-myprojects/hrms-airtable-july2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/react-myprojects/hrms-airtable-july2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:/react-myprojects/hrms-airtable-july2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"D:/react-myprojects/hrms-airtable-july2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React,{useState,useEffect,useRef}from\"react\";import MaterialTable,{MTableToolbar}from\"material-table\";import{makeStyles}from\"@material-ui/core/styles\";import{Button,Icon,TextField,MenuItem}from\"@material-ui/core\";import{useHistory,Link}from\"react-router-dom\";import{useSetRecoilState,useRecoilValue}from\"recoil\";import{payPeriodState,payPeriodEndMonthState,payPeriodEmpIdState,payEarningDataState}from\"./data/atomdata\";import{usePayslipsContext}from\"../context/payslips_context\";import{useTablesContext}from\"../context/tables_context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Payslip_Earnings(_ref){var setCalc=_ref.setCalc,earningsdata=_ref.earningsdata,oldEarningsdata=_ref.oldEarningsdata,setEarningsdata=_ref.setEarningsdata,handleDialogClose=_ref.handleDialogClose;var history=useHistory();var classes=useStyles();var payPeriodEmpId=useRecoilValue(payPeriodEmpIdState);var payPeriod=useRecoilValue(payPeriodState);var payEarningData=useRecoilValue(payEarningDataState);var _usePayslipsContext=usePayslipsContext(),payslipearnings=_usePayslipsContext.payslipearnings,payslip_earning_amount=_usePayslipsContext.payslip_earning_amount,setPayslipEarningAmount=_usePayslipsContext.setPayslipEarningAmount,addPayslipEarning=_usePayslipsContext.addPayslipEarning,payslipearnings_loading=_usePayslipsContext.payslipearnings_loading,updatePayslipEarning=_usePayslipsContext.updatePayslipEarning,deletePayslipEarning=_usePayslipsContext.deletePayslipEarning,updatePayslip=_usePayslipsContext.updatePayslip,editPayslipID=_usePayslipsContext.editPayslipID,single_payslip=_usePayslipsContext.single_payslip,payslip_period=_usePayslipsContext.payslip_period,getSingleBatchPayslipEarnings=_usePayslipsContext.getSingleBatchPayslipEarnings;var name=payslipearnings.name,amount=payslipearnings.amount;var _useTablesContext=useTablesContext(),allowances=_useTablesContext.allowances;var columns=[{title:\"Description\",field:\"description\",editComponent:function editComponent(props){return/*#__PURE__*/_jsx(TextField//defaultValue={props.value || null}\n,{onChange:function onChange(e){return props.onChange(e.target.value);},style:{width:200},value:props.value,select:true,children:allowances.map(function(r){return/*#__PURE__*/_jsx(MenuItem,{value:r.name,children:r.name});})});}},{title:\"Amount\",field:\"amount\",type:\"currency\"}];useEffect(function(){getSingleBatchPayslipEarnings(single_payslip.empid,payslip_period);},[]);var calc_Earning=function calc_Earning(data){var sum=data.reduce(function(a,v){return a=a+v.amount;},0);console.log(\"Earning\",data);setPayslipEarningAmount(sum);};var update_Payslip=function update_Payslip(){var rec_id=single_payslip.rec_id,id=single_payslip.id,total_earnings=single_payslip.total_earnings,paydata=_objectWithoutProperties(single_payslip,[\"rec_id\",\"id\",\"total_earnings\"]);updatePayslip(_objectSpread({id:editPayslipID,total_earnings:payslip_earning_amount},paydata));setCalc(true);};var update_PayslipEarning=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var id,rec_id,empid,fields;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:id=data.id,rec_id=data.rec_id,empid=data.empid,fields=_objectWithoutProperties(data,[\"id\",\"rec_id\",\"empid\"]);console.log(\"update\",data);updatePayslipEarning(_objectSpread({id:data.id,empid:empid},fields));update_Payslip();getSingleBatchPayslipEarnings(single_payslip.empid,payslip_period);case 5:case\"end\":return _context.stop();}}},_callee);}));return function update_PayslipEarning(_x){return _ref2.apply(this,arguments);};}();var add_PayslipEarning=function add_PayslipEarning(data){console.log(\"add\",data);var description=data.description,amount=data.amount;addPayslipEarning({description:description,amount:amount,name:single_payslip.name,empid:single_payslip.empid,period:single_payslip.period});getSingleBatchPayslipEarnings(single_payslip.empid,payslip_period);};var delete_PayslipEarning=function delete_PayslipEarning(data){var id=data.id;deletePayslipEarning(id);getSingleBatchPayslipEarnings(single_payslip.empid,payslip_period);};var Save_EarningsData=function Save_EarningsData(){// delete unwanted data\nconsole.log(\"update\",earningsdata,oldEarningsdata);oldEarningsdata.forEach(function(row){var id=row.id,rec_id=row.rec_id;var res=earningsdata.find(function(r){return r.rec_id===rec_id;});console.log(\"find\",id,res);if(!res){deletePayslipEarning(id);}});//add or update new data\nearningsdata.forEach(function(data){var id=data.id,description=data.description,amount=data.amount;if(id){var _id=data.id,rec_id=data.rec_id,tableData=data.tableData,fields=_objectWithoutProperties(data,[\"id\",\"rec_id\",\"tableData\"]);updatePayslipEarning(_objectSpread({id:_id},fields));}else{addPayslipEarning({description:description,amount:amount,name:single_payslip.name,empid:payPeriodEmpId,period:payPeriod});}});handleDialogClose();};if(payslipearnings_loading){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading... Incomes.\"})});}return/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:/*#__PURE__*/_jsx(\"div\",{style:{maxWidth:\"100%\",paddingTop:\"5px\"},children:/*#__PURE__*/_jsx(MaterialTable,{columns:columns,data:earningsdata,title:\"Income\",editable:{onRowAdd:function onRowAdd(newData){return new Promise(function(resolve,reject){setTimeout(function(){setEarningsdata([].concat(_toConsumableArray(earningsdata),[newData]));resolve();},1000);});},onRowUpdate:function onRowUpdate(newData,oldData){return new Promise(function(resolve,reject){setTimeout(function(){var dataUpdate=_toConsumableArray(earningsdata);var index=oldData.tableData.id;dataUpdate[index]=newData;setEarningsdata(_toConsumableArray(dataUpdate));resolve();},1000);});},onRowDelete:function onRowDelete(oldData){return new Promise(function(resolve,reject){setTimeout(function(){var dataDelete=_toConsumableArray(earningsdata);var index=oldData.tableData.id;dataDelete.splice(index,1);setEarningsdata(_toConsumableArray(dataDelete));resolve();},1000);});}},options:{filtering:true,headerStyle:{backgroundColor:\"orange\",color:\"primary\"},showTitle:true},components:{Toolbar:function Toolbar(props){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(MTableToolbar,_objectSpread({},props)),/*#__PURE__*/_jsx(\"div\",{style:{padding:\"5px 10px\"},children:/*#__PURE__*/_jsxs(Button,{type:\"submit\",variant:\"contained\",color:\"secondary\",className:classes.button,onClick:Save_EarningsData,children:[\"Update \",/*#__PURE__*/_jsx(Icon,{className:classes.rightIcon,children:\"send\"})]})})]});}}})})});}var useStyles=makeStyles(function(theme){return{root:{padding:0}};});","map":{"version":3,"sources":["D:/react-myprojects/hrms-airtable-july2/src/components/Payslip_Earnings.js"],"names":["React","useState","useEffect","useRef","MaterialTable","MTableToolbar","makeStyles","Button","Icon","TextField","MenuItem","useHistory","Link","useSetRecoilState","useRecoilValue","payPeriodState","payPeriodEndMonthState","payPeriodEmpIdState","payEarningDataState","usePayslipsContext","useTablesContext","Payslip_Earnings","setCalc","earningsdata","oldEarningsdata","setEarningsdata","handleDialogClose","history","classes","useStyles","payPeriodEmpId","payPeriod","payEarningData","payslipearnings","payslip_earning_amount","setPayslipEarningAmount","addPayslipEarning","payslipearnings_loading","updatePayslipEarning","deletePayslipEarning","updatePayslip","editPayslipID","single_payslip","payslip_period","getSingleBatchPayslipEarnings","name","amount","allowances","columns","title","field","editComponent","props","e","onChange","target","value","width","map","r","type","empid","calc_Earning","data","sum","reduce","a","v","console","log","update_Payslip","rec_id","id","total_earnings","paydata","update_PayslipEarning","fields","add_PayslipEarning","description","period","delete_PayslipEarning","Save_EarningsData","forEach","row","res","find","tableData","root","maxWidth","paddingTop","onRowAdd","newData","Promise","resolve","reject","setTimeout","onRowUpdate","oldData","dataUpdate","index","onRowDelete","dataDelete","splice","filtering","headerStyle","backgroundColor","color","showTitle","Toolbar","padding","button","rightIcon","theme"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\n\r\nimport MaterialTable, { MTableToolbar } from \"material-table\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { Button, Icon, TextField, MenuItem } from \"@material-ui/core\";\r\n\r\nimport { useHistory, Link } from \"react-router-dom\";\r\nimport { useSetRecoilState, useRecoilValue } from \"recoil\";\r\nimport {\r\n  payPeriodState,\r\n  payPeriodEndMonthState,\r\n  payPeriodEmpIdState,\r\n  payEarningDataState,\r\n} from \"./data/atomdata\";\r\nimport { usePayslipsContext } from \"../context/payslips_context\";\r\nimport { useTablesContext } from \"../context/tables_context\";\r\n\r\nexport default function Payslip_Earnings({\r\n  setCalc,\r\n  earningsdata,\r\n  oldEarningsdata,\r\n  setEarningsdata,\r\n  handleDialogClose,\r\n}) {\r\n  let history = useHistory();\r\n   const classes = useStyles();\r\n  const payPeriodEmpId = useRecoilValue(payPeriodEmpIdState);\r\n  const payPeriod = useRecoilValue(payPeriodState);\r\n  const payEarningData = useRecoilValue(payEarningDataState);\r\n  const {\r\n    payslipearnings,\r\n    payslip_earning_amount,\r\n    setPayslipEarningAmount,\r\n    addPayslipEarning,\r\n    payslipearnings_loading,\r\n    updatePayslipEarning,\r\n    deletePayslipEarning,\r\n    updatePayslip,\r\n    editPayslipID,\r\n    single_payslip,\r\n    payslip_period,\r\n    getSingleBatchPayslipEarnings,\r\n  } = usePayslipsContext();\r\n\r\n  const { name, amount } = payslipearnings;\r\n  const { allowances } = useTablesContext();\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Description\",\r\n      field: \"description\",\r\n      editComponent: (props) => (\r\n        <TextField\r\n          //defaultValue={props.value || null}\r\n          onChange={(e) => props.onChange(e.target.value)}\r\n          style={{ width: 200 }}\r\n          value={props.value}\r\n          select\r\n        >\r\n          {allowances.map((r) => {\r\n            return <MenuItem value={r.name}>{r.name}</MenuItem>;\r\n          })}\r\n        </TextField>\r\n      ),\r\n    },\r\n    { title: \"Amount\", field: \"amount\", type: \"currency\" },\r\n  ];\r\n\r\n  useEffect(() => {\r\n    getSingleBatchPayslipEarnings(single_payslip.empid, payslip_period);\r\n  }, []);\r\n\r\n  const calc_Earning = (data) => {\r\n    const sum = data.reduce((a, v) => (a = a + v.amount), 0);\r\n    console.log(\"Earning\", data);\r\n    setPayslipEarningAmount(sum);\r\n  };\r\n\r\n  const update_Payslip = () => {\r\n    const { rec_id, id, total_earnings, ...paydata } = single_payslip;\r\n    updatePayslip({\r\n      id: editPayslipID,\r\n      total_earnings: payslip_earning_amount,\r\n      ...paydata,\r\n    });\r\n    setCalc(true);\r\n  };\r\n\r\n  const update_PayslipEarning = async (data) => {\r\n    const { id, rec_id, empid, ...fields } = data;\r\n    console.log(\"update\", data);\r\n    updatePayslipEarning({ id: data.id, empid: empid, ...fields });\r\n\r\n    update_Payslip();\r\n    getSingleBatchPayslipEarnings(single_payslip.empid, payslip_period);\r\n  };\r\n\r\n  const add_PayslipEarning = (data) => {\r\n    console.log(\"add\", data);\r\n    const { description, amount } = data;\r\n    addPayslipEarning({\r\n      description: description,\r\n      amount: amount,\r\n      name: single_payslip.name,\r\n      empid: single_payslip.empid,\r\n      period: single_payslip.period,\r\n    });\r\n\r\n    getSingleBatchPayslipEarnings(single_payslip.empid, payslip_period);\r\n  };\r\n\r\n  const delete_PayslipEarning = (data) => {\r\n    const { id } = data;\r\n    deletePayslipEarning(id);\r\n    getSingleBatchPayslipEarnings(single_payslip.empid, payslip_period);\r\n  };\r\n\r\n  const Save_EarningsData = () => {\r\n    // delete unwanted data\r\n    console.log(\"update\", earningsdata, oldEarningsdata);\r\n    oldEarningsdata.forEach((row) => {\r\n      const { id, rec_id } = row;\r\n      const res = earningsdata.find((r) => r.rec_id === rec_id);\r\n      console.log(\"find\", id, res);\r\n      if (!res) {\r\n        deletePayslipEarning(id);\r\n      }\r\n    });\r\n    //add or update new data\r\n\r\n    earningsdata.forEach((data) => {\r\n      const { id, description, amount } = data;\r\n      if (id) {\r\n        const { id, rec_id, tableData, ...fields } = data;\r\n        updatePayslipEarning({ id, ...fields });\r\n      } else {\r\n        addPayslipEarning({\r\n          description: description,\r\n          amount: amount,\r\n          name: single_payslip.name,\r\n          empid: payPeriodEmpId,\r\n          period: payPeriod,\r\n        });\r\n      }\r\n    });\r\n\r\n    handleDialogClose();\r\n  };\r\n\r\n  if (payslipearnings_loading) {\r\n    return (\r\n      <div>\r\n        <h2>Loading... Incomes.</h2>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      {/* <h1>Expenses Claims Application</h1> */}\r\n\r\n      <div style={{ maxWidth: \"100%\", paddingTop: \"5px\" }}>\r\n        <MaterialTable\r\n          columns={columns}\r\n          data={earningsdata}\r\n          title=\"Income\"\r\n          editable={{\r\n            onRowAdd: (newData) =>\r\n              new Promise((resolve, reject) => {\r\n                setTimeout(() => {\r\n                  setEarningsdata([...earningsdata, newData]);\r\n                  resolve();\r\n                }, 1000);\r\n              }),\r\n            onRowUpdate: (newData, oldData) =>\r\n              new Promise((resolve, reject) => {\r\n                setTimeout(() => {\r\n                  const dataUpdate = [...earningsdata];\r\n                  const index = oldData.tableData.id;\r\n                  dataUpdate[index] = newData;\r\n                  setEarningsdata([...dataUpdate]);\r\n\r\n                  resolve();\r\n                }, 1000);\r\n              }),\r\n            onRowDelete: (oldData) =>\r\n              new Promise((resolve, reject) => {\r\n                setTimeout(() => {\r\n                  const dataDelete = [...earningsdata];\r\n                  const index = oldData.tableData.id;\r\n                  dataDelete.splice(index, 1);\r\n                  setEarningsdata([...dataDelete]);\r\n\r\n                  resolve();\r\n                }, 1000);\r\n              }),\r\n          }}\r\n          options={{\r\n            filtering: true,\r\n            headerStyle: {\r\n              backgroundColor: \"orange\",\r\n              color: \"primary\",\r\n            },\r\n            showTitle: true,\r\n          }}\r\n          components={{\r\n            Toolbar: (props) => (\r\n              <div>\r\n                <MTableToolbar {...props} />\r\n                <div style={{ padding: \"5px 10px\" }}>\r\n                  <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={Save_EarningsData}\r\n                  >\r\n                    Update <Icon className={classes.rightIcon}>send</Icon>\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ),\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    padding: 0,\r\n  },\r\n}));\r\n"]},"metadata":{},"sourceType":"module"}